<?php

namespace weha\UBL\Invoice;

use Sabre\Xml\Writer;
use Sabre\Xml\XmlSerializable;

class SettlementPeriod implements XmlSerializable
{
	private $startDate;
	private $endDate;

	/**
	 * @return mixed
	 */
	public function getStartDate()
	{
		return $this->startDate;
	}

	/**
	 * @param mixed $startDate
	 * @return DateTime
	 */
	public function setStartDate(\DateTime $startDate)
	{
		$this->startDate = $startDate;
		return $this;
	}

	/**
	 * @return mixed
	 */
	public function getEndDate()
	{
		return $this->endDate;
	}

	/**
	 * @param mixed $endDate
	 * @return DateTime
	 */
	public function setEndDate(\DateTime $endDate)
	{
		$this->endDate = $endDate;
		return $this;
    }

	/**
	 * The validate function that is called during xml writing to valid the data of the object.
	 *
	 * @throws InvalidArgumentException An error with information about required data that is missing to write the XML
	 * @return void
	 */
	function validate()
	{
        if ($this->startDate === null)
        {
			throw new \InvalidArgumentException('Missing startDate');
        }
        if ($this->endDate === null)
        {
			throw new \InvalidArgumentException('Missing endDate');
        }
    }

	/**
	 * The xmlSerialize method is called during xml writing.
	 *
	 * @param Writer $writer
	 * @return void
	 */
	function xmlSerialize(Writer $writer)
	{
        $this->validate();

		$writer->write([
			Schema::CBC . 'StartDate' => $this->startDate->format('Y-m-d'),
			Schema::CBC . 'EndDate' => $this->endDate->format('Y-m-d'),
        ]);

		$writer->write([
			[
				'name' => Schema::CBC . 'DurationMeasure',
				'value' => $this->endDate->diff($this->startDate)->format('%a'),
				'attributes' => [
					'unitCode' => 'DAY'
				]
			]
		]);
	}
}
